package com.socialnetwork.mentis.data.paging\n\nimport androidx.paging.PagingSource\nimport androidx.paging.PagingState\nimport com.socialnetwork.mentis.core.data.mapper.toDomain\nimport com.socialnetwork.mentis.core.data.remote.FeedApi\nimport com.socialnetwork.mentis.core.domain.model.Post\nimport com.socialnetwork.mentis.core.domain.model.Result\n\nclass PostPagingSource(\n    private val feedApi: FeedApi\n) : PagingSource<Int, Post>() {\n\n    override suspend fun load(params: LoadParams<Int>): LoadResult<Int, Post> {\n        val page = params.key ?: 1\n        val pageSize = params.loadSize\n\n        return when (val result = feedApi.getFeed(page, pageSize)) {\n            is Result.Success -> {\n                val posts = result.data.map { it.toDomain() }\n                LoadResult.Page(\n                    data = posts,\n                    prevKey = if (page == 1) null else page - 1,\n                    nextKey = if (posts.isEmpty()) null else page + 1\n                )\n            }\n            is Result.Error -> {\n                LoadResult.Error(Exception(result.error.message))\n            }\n        }\n    }\n\n    override fun getRefreshKey(state: PagingState<Int, Post>): Int? {\n        return state.anchorPosition?.let {\ anchorPosition ->\n            state.closestPageToPosition(anchorPosition)?.prevKey?.plus(1) \n                ?: state.closestPageToPosition(anchorPosition)?.nextKey?.minus(1)\n        }\n    }\n}\n