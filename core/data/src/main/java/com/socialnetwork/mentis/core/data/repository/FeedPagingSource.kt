package com.socialnetwork.mentis.core.data.repository\n\nimport androidx.paging.PagingSource\nimport androidx.paging.PagingState\nimport com.socialnetwork.mentis.core.data.remote.FeedApi\nimport com.socialnetwork.mentis.core.data.remote.dto.PostDto\n\nclass FeedPagingSource(\n    private val feedApi: FeedApi\n) : PagingSource<Int, PostDto>() {\n\n    override suspend fun load(params: LoadParams<Int>): LoadResult<Int, PostDto> {\n        return try {\n            val page = params.key ?: 1\n            val response = feedApi.getFeedPosts(page = page, limit = params.loadSize)\n            LoadResult.Page(\n                data = response,\n                prevKey = if (page == 1) null else page - 1,\n                nextKey = if (response.isEmpty()) null else page + 1\n            )\n        } catch (e: Exception) {\n            LoadResult.Error(e)\n        }\n    }\n\n    override fun getRefreshKey(state: PagingState<Int, PostDto>): Int? {\n        return state.anchorPosition?.let {\ anchorPosition ->\n            state.closestPageToPosition(anchorPosition)?.prevKey?.plus(1)\n                ?: state.closestPageToPosition(anchorPosition)?.nextKey?.minus(1)\n        }\n    }\n}\n